# Build stage
FROM aws.registry.trendmicro.com/etscache/library/openjdk:8-jdk-bullseye@sha256:c25fa22ba2961758802ea63bc4622999a305086405d9d03b065925da00cb8bb6 as build_env

ARG JFROG_USER_EMAIL
ARG JFROG_API_KEY
ARG JFROG_MAVEN_REGISTRY_PREFIX
ARG REGISTRY_LOCAL_AMAAS
ARG BUILD_VERSION
ARG PACK_CMD=package

# Dependencies

RUN apt-get update && apt-get install -y --no-install-recommends \
	maven \
	&& apt-get clean \
	&& rm -rf /var/lib/apt/lists/*

# Copy source code

WORKDIR amaas-java-module

COPY pom.xml .

COPY src/ src/
RUN mkdir -p src/main/proto
COPY scan.proto src/main/proto/

# Build java-sdk

RUN mvn clean ${PACK_CMD} -X
